(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{553:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"ios-屏幕共享功能实现"}},[t._v("iOS 屏幕共享功能实现")]),t._v(" "),a("p",[t._v("本文档描述基于 EVSDK 实现 iOS 版本客户端应用的会议中屏幕共享功能，其中重点介绍了所使用到的 APP Extension 、EVSDK 等信息，此功能仅支持 iOS12 以上的系统。该功能的实现依赖于 iOS 的 ReplayKit 功能，有关背景内容可以参考 Apple 文档， "),a("a",{attrs:{href:"https://developer.apple.com/videos/play/wwdc2018/601/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.apple.com/videos/play/wwdc2018/601/"),a("OutboundLink")],1),t._v("， "),a("a",{attrs:{href:"https://developer.apple.com/videos/play/wwdc2017/606/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.apple.com/videos/play/wwdc2017/606/"),a("OutboundLink")],1),t._v(" 和 "),a("a",{attrs:{href:"https://developer.apple.com/documentation/replaykit",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.apple.com/documentation/replaykit"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"前期准备工作"}},[t._v("前期准备工作")]),t._v(" "),a("h3",{attrs:{id:"创建-extensions-bundle-identifier"}},[t._v("创建 Extensions Bundle Identifier")]),t._v(" "),a("p",[t._v("前往开发者网站 "),a("a",{attrs:{href:"https://developer.apple.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.apple.com/"),a("OutboundLink")],1)]),t._v(" "),a("ul",[a("li",[a("p",[t._v("创建 App Groups, 在Certificates, Identifiers & Profiles 中选择 Identifiers，找到 App Groups 并创建，格式 group+ 域名翻转")]),t._v(" "),a("p",[t._v("//示例： "),a("code",[t._v("group.com.hexmeet")])])]),t._v(" "),a("li",[a("p",[t._v("创建两个 Extension 的 Identifiers")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"},[t._v("注意")]),a("p",[t._v("创建 Identifiers，格式前缀务必使用与主程序 bundleID 相对应的域名反写，并分别设置为 uploadext 、setupuiext")])]),a("p",[t._v("//示例 Identifiers："),a("code",[t._v("com.hexmeet.hjtdebug.uploadext")]),t._v("\t, "),a("code",[t._v("com.hexmeet.hjtdebug.setupuiext")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("为 bundle identifier 增加 App Groups 设置")]),t._v(" "),a("p",[t._v("Extension 的 bundle identifier 创建完成后，查看详情，并在Capabilities 的 App Groups 中编辑，选择创建好的 App Group 名")]),t._v(" "),a("p",[t._v("然后，查看主程序的 bundle identifier 的 Capabilities 中同样勾选 App Groups，编辑并选择新创建的 App Group 名")])]),t._v(" "),a("li",[a("p",[t._v("创建相应的 Extension 描述文件，并更新主程序的描述文件 (因为主程序的 Capabilities 中增加了 App Groups 设置)")])])]),t._v(" "),a("h3",{attrs:{id:"项目工程修改"}},[t._v("项目工程修改")]),t._v(" "),a("p",[t._v("程序中创建 APP Extension，设置相关配置")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("创建 tagert，选择 iOS 下的 Application Extension 模块下的 Broadcast Upload Extension，创建过程中如果勾选 Include UI Extension 则系统会自动生成 Broadcast Setup UI Extension。如果没有勾选，请再创建一个 Broadcast Setup UI Extension")])]),t._v(" "),a("li",[a("p",[t._v("创建完成之后，开始配置相关功能，选择主程序 target 的 Signing & Capabilities 点击 +Capability，增加 App Groups 功能，增加完成之后勾选之前创建好的 App Group 的 Identifiers。依次选择创建好的两个 Extension 并配置 App Groups，App Groups 的Identifiers 要选择和主程序 App Group 勾选的 Identifiers 一致。")])])]),t._v(" "),a("h2",{attrs:{id:"app-extension-使用"}},[t._v("APP Extension 使用")]),t._v(" "),a("p",[t._v("屏幕共享依赖于系统提供的 Broadcast Upload Extension 和 Broadcast Setup UI Extension")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Broadcast Upload Extension 和 Container app 之间通讯以 APP Group 方式形式进行，此进程为主要收集原始音视频数据以及录制进程状态的通知")])]),t._v(" "),a("li",[a("p",[t._v("Broadcast Setup UI Extension 这个进程通常用于让用户输入一些信息来鉴权，或者自定义其他界面，在启动录制进程之间插入的一个交互的页面,这里可以不做操作使用系统提供的配置方法")])]),t._v(" "),a("li",[a("p",[t._v("接收原始音视频数据 (Broadcast Upload Extension 提供的 SampleHandler 回调类中)，为了方便对原始数据进行内容处理，请将SampleHandler.m 文件修改成 SampleHandler.mm")])])]),t._v(" "),a("h3",{attrs:{id:"音频内容原始数据接收方法"}},[t._v("音频内容原始数据接收方法")]),t._v(" "),a("div",{staticClass:"language-objectivec extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("processSampleBuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CMSampleBufferRef"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("sampleBuffer withType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RPSampleBufferType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" sampleBufferType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"对原始数据进行处理-复制此方法"}},[t._v("对原始数据进行处理：(复制此方法)")]),t._v(" "),a("div",{staticClass:"language-objectivec extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("sendVideoBuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CMSampleBufferRef"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("sampleBuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"extension-和-contain-app之间通讯以-app-group-方式形式进行"}},[t._v("Extension 和 Contain app之间通讯以 APP Group 方式形式进行：")]),t._v(" "),a("div",{staticClass:"language-objectivec extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("broadcastStartedWithSetupInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSDictionary"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("NSString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("NSObject "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("setupInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("//示例代码")]),t._v(" "),a("div",{staticClass:"language-objectivec extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("broadcastStartedWithSetupInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSDictionary"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("NSString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("NSObject "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("setupInfo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n   _userDefault "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSUserDefaults alloc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" initWithSuiteName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"group.com.hexmeet"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   _containerURL "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSFileManager defaultManager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" containerURLForSecurityApplicationGroupIdentifier"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"group.com.hexmeet"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   URLByAppendingPathComponent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"Library/Caches/yuvframe"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("_userDefault setBool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("YES forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"broadcastStarted"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("_userDefault synchronize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"屏幕停止录制系统会通过"}},[t._v("屏幕停止录制系统会通过：")]),t._v(" "),a("div",{staticClass:"language-objectivec extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("broadcastFinished"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//示例代码")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("broadcastFinished "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("_userDefault setBool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("YES forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"broadcastFinished"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("_userDefault synchronize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"},[t._v("注意")]),a("p",[t._v("事项及说明")]),t._v(" "),a("p",[t._v("_userDefault 在屏幕录制共享的数据内容中，我们标记了3种状态方式：broadcastStarted、videobufferready、broadcastFinished，可参考 demo 用法")])]),a("h2",{attrs:{id:"evsdk、replaykit-使用"}},[t._v("EVSDK、ReplayKit 使用")]),t._v(" "),a("h3",{attrs:{id:"evsdk-相关方法"}},[t._v("EVSDK 相关方法")]),t._v(" "),a("div",{staticClass:"language-objectivec extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" sendContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" setLocalContentSourceInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EVContentSourceInfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("_Nonnull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" stopContent；\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" onContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EVContentInfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("_Nonnull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("当调用 -(int) sendContent 方法会在 SDK 提供的 "),a("code",[t._v("- (void)onContent:(EVContentInfo * _Nonnull)info")]),t._v(" 中收到回调")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"},[t._v("注意")]),a("p",[t._v("info.status == EVContentDenied 意为禁止分享\n当前会议收到回调status为EVContentDenied，请主动关闭分享操作，具体使用细节请参照 demo")]),t._v(" "),a("p",[t._v("info.dir == EVStreamUpload  当前会议环境若处于双流状态，操作点击分享，收到回调 dir 为 EVStreamUpload，请关闭双流界面，具体使用细节请参照 demo")]),t._v(" "),a("p",[t._v("info.dir == EVStreamDownload\n当前会议若处于主动分享状态时，收到回调 dir 为EVStreamDownload，请主动关闭分享操作，改为被动接收分享，具体使用细节请参照 demo")]),t._v(" "),a("p",[t._v("sendContent、 stopContent 、setLocalContentSourceInfo 具体使用细节请参照 demo 中提供的 startShareTimer() 和 stopShareTimer()方法")])]),a("h2",{attrs:{id:"replaykit-使用"}},[t._v("Replaykit 使用")]),t._v(" "),a("p",[t._v("录制 UI 界面我们使用 RPSystemBroadcastPickerView，iOS12 之后提供的录屏 UI 控件")]),t._v(" "),a("div",{staticClass:"language-objectivec extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[t._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//示例代码，注意broadcastPickerView.preferredExtension 为upload extension的bundleID")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" #"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("available")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iOS "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n      let broadcastPickerView "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("RPSystemBroadcastPickerView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CGRect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" width"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" height"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("40")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n      broadcastPickerView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4567")]),t._v("\n\n      broadcastPickerView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("showsMicrophoneButton "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" false\n\n      broadcastPickerView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("preferredExtension "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\(getInfoString("')]),t._v("CFBundleIdentifier"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"))\\("')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uploadext"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('")"')]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addSubview")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("broadcastPickerView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n      broadcastPickerView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isHidden "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" true\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("具体使用此控件方法：")]),t._v(" "),a("div",{staticClass:"language-objectivec extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//示例代码")]),t._v("\n\n  func "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("shareMGBtnAction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" shareMGLb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"video.startShare"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("localized "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//share")]),t._v("\n\n         isSeletShare "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" true\n\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" #"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("available")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iOS "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n               var btn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("UIButton "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("UIButton")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n               let broadcastPickerView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("RPSystemBroadcastPickerView "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("viewWithTag")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4567")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" as"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" RPSystemBroadcastPickerView\n\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" item"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("UIView "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" broadcastPickerView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subviews "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n                   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v("   item"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isKind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("of"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" UIButton"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("classForCoder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n                         btn "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" item as"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" UIButton\n\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" #"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("available")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iOS "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    btn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendActions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" UIControl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("touchUpInside"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    btn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendActions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" UIControl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("touchDown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n             \n\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("startShareTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n          "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stopShareTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n###  func "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("startShareTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 方法为录制数据内容和evsdk交互的主要方法\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//示例代码")]),t._v("\n\nfunc "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("startShareTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    userDefault "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UserDefaults"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("suiteName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"group.com.hexmeet"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    userDefault"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("false"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"broadcastFinished"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    userDefault"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("false"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"videobufferready"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    userDefault"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("synchronize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" shareTimer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" nil "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        shareTimer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Timer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduledTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timeInterval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" selector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" #"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pushShareContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" userInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" repeats"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("此方法 0.2S  即代表每秒 5 帧画面")]),t._v(" "),a("p",[t._v("在定时器的 pushShareContent 方法中对 extension 存储的数据进行处理并传给 EVSDK")]),t._v(" "),a("p",[t._v("//示例代码请参照demo：   "),a("code",[t._v("@objc func pushShareContent() {}")]),t._v(" 方法")]),t._v(" "),a("h3",{attrs:{id:"停止录制时"}},[t._v("停止录制时")]),t._v(" "),a("p",[t._v("//示例代码请参照demo ：   "),a("code",[t._v("func stopShareTimer() {}")]),t._v("方法")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"},[t._v("注意")]),a("p",[t._v("会议挂断请主动再次调用  "),a("code",[t._v("func stopShareTimer() {}")]),t._v("方法，确保会议结束调用 "),a("code",[t._v("func stopShareTimer() {}")]),t._v(" 方法")])])])}),[],!1,null,null,null);s.default=e.exports}}]);